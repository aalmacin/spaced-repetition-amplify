<div class="card-manager">
  <app-loading *ngIf="loading; else cardManager"></app-loading>
  <ng-template #cardManager>
    <ng-container>
      <h2 class="header">Cards</h2>

      <div class="cards-container">
        <div class="togglers">
          <input type="checkbox" id="filter-toggle" class="filter-toggle" />
          <label class="add-card-toggler" for="add-card-toggle"> </label>
          <label *ngIf="cards.length > 0" class="filter-toggler" for="filter-toggle">
            Filter
            <i class="fas fa-filter"></i>
          </label>

          <div class="add-card">
            <form class="add-card__form" [formGroup]="addCardForm" (submit)="addNewCard()">
              <div class="errors">
                <al-alert [messages]="errors" type="error"></al-alert>
              </div>
              <div class="messages">
                <al-alert [messages]="messages" type="success"></al-alert>
              </div>
              <div class="errors">
                <ng-container *ngIf="addCardForm.status === 'INVALID' && addCardForm.touched">
                  <al-alert [messages]="['Front, back, and topic required']" type="error"></al-alert>
                </ng-container>
              </div>
              <input
                #front
                class="add-card__front"
                formControlName="front"
                name="front"
                placeholder="Ex. What is life? (Front/Question)"
              />
              <textarea
                #back
                rows="4"
                class="add-card__back"
                formControlName="back"
                name="back"
                placeholder="Ex. 42 is the meaning of life according to Hitchikers Guide to the Galaxy (Back/Answer)"
              ></textarea>

              <select class="add-card__topic" formControlName="topicId" name="topicId">
                <option value="">Select Topic</option>
                <option *ngFor="let topic of topics" [value]="topic.id">{{ topic.name }}</option>
              </select>

              <div>
                <input type="checkbox" formControlName="reverseCard" />
                <label>Create Reverse Card</label>
              </div>

              <button
                class="add-card__submit"
                [disabled]="addCardForm.status === 'INVALID'"
                alBtn="primary"
                size="fit"
                type="secondary"
              >
                Create Card
              </button>
            </form>
          </div>

          <div class="filter">
            <div class="filter__container">
              <div class="filter__field">
                <label for="search" class="al-semibold">Filter</label>
              </div>

              <div class="filter__field">
                <input
                  (input)="changeSearchTerm(searchTerm.value)"
                  #searchTerm
                  id="search"
                  class="filter__input filter__input--search"
                  type="text"
                  placeholder="Search Term: Topic Name/Front/Back"
                />
              </div>

              <div class="filter__field">
                <input
                  (change)="changeIsReadyStudy()"
                  #readyStudyOnly
                  id="study"
                  class="filter__study"
                  type="checkbox"
                  [checked]="isReadyStudyOnly"
                />
                <label for="study">Ready to Study?</label>
              </div>
            </div>
          </div>
        </div>

        <ng-container *ngIf="(filteredCards | async).length > 0; else noCards">
          <!-- <div class="card-header">
            <div class="card-header__topic-name">Topic Name</div>
            <div class="card-header__front">Front</div>
            <div class="card-header__back">Back</div>
            <div class="card-header__box">Box</div>
            <div class="card-header__ready">Ready to Study</div>
            <div class="card-header__next-study">Next Study</div>
            <div class="card-header__action"></div>
          </div> -->
          <div class="cards" *ngFor="let card of filteredCards | async; let i = index">
            <app-card-info [card]="card"></app-card-info>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </ng-template>
</div>

<ng-template #noCards>
  <div class="no-cards">
    <div class="no-cards__icon">
      <i class="fas fa-couch"></i>
    </div>
    <p class="no-cards__message">
      No cards yet. Start adding now!<br />
      If that's not the case, you might be having connectivity issues. Try again later.
    </p>
  </div>
</ng-template>
